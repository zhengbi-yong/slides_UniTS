---
# You can also start simply with 'default'
theme: seriph
# random image from a curated Unsplash collection by Anthony
# like them? see https://unsplash.com/collections/94734566/slidev
background: https://cover.sli.dev
# some information about your slides (markdown enabled)
title: "UniTS: A Unified Multi-Task Time Series Model"
info: |
  ## Slidev Starter Template
  Presentation slides for developers.

  Learn more at [Sli.dev](https://sli.dev)
# apply unocss classes to the current slide
class: text-center
# https://sli.dev/features/drawing
drawings:
  persist: false
# slide transition: https://sli.dev/guide/animations.html#slide-transitions
transition: slide-left
# enable MDC Syntax: https://sli.dev/features/mdc
mdc: true
---

# UniTS: A Unified Multi-Task Time Series Model

ç®€è¦ä»‹ç»æ—¶é—´åºåˆ—é¢†åŸŸçš„ä¸€ä¸ªå¤§ä¸€ç»Ÿæ¨¡å‹

<div @click="$slidev.nav.next" class="mt-12 py-1" hover:bg="white op-10">
  è¿›å…¥æ­£é¢˜ <carbon:arrow-right />
</div>

<div class="abs-br m-6 text-xl">
  <a href="https://github.com/mims-harvard/UniTS" target="_blank" class="slidev-icon-btn">
    <carbon:logo-github />
  </a>
</div>

<!--
The last comment block of each slide will be treated as slide notes. It will be visible and editable in Presenter Mode along with the slide. [Read more in the docs](https://sli.dev/guide/syntax.html#notes)
-->

---
transition: fade-out
---

# UNITSï¼ˆA Unified Multi-Task Time Series Modelï¼‰é‡ç‚¹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ–¹é¢

UniTS çš„è¡¨ç°ä¼˜äºç«äº‰æ€§çš„ä»»åŠ¡ä¸“é—¨æ—¶é—´åºåˆ—æ¨¡å‹ã€‚ä»£ç å’Œæ•°æ®é›†å¯åœ¨ https://github.com/mims-harvard/UniTS ä¸Šæ‰¾åˆ°ã€‚

- ğŸ™‹â€ ä¸€ã€è¾“å…¥æ ¼å¼ç»Ÿä¸€ä¸é€‚é…
- ğŸ¦œ äºŒã€UNITSçš„æ•´ä½“æ¨¡å‹ç»“æ„åŠå„éƒ¨åˆ†ä½œç”¨
- ğŸ“š ä¸‰ã€Prompt Learningåœ¨UNITSä¸­çš„å®ç°åŠæ„ä¹‰
- ğŸ¤¹ å››ã€æ ·æœ¬æ ‡è®°(Sample Tokens)ã€æç¤ºæ ‡è®°(Prompt Tokens)ã€ä»»åŠ¡æ ‡è®°(Task Tokens)çš„æ¥æºã€æ ¼å¼å’Œå®ç°æ–¹æ³•
- ğŸ—¼äº”ã€GEN towerå’ŒCLS toweråˆ†åˆ«æœ‰ä»€ä¹ˆç”¨å¤„ï¼Ÿ
- ğŸ”¢å…­ã€æ•°æ®é¢„å¤„ç†
- ğŸ ä¸ƒã€ä»»åŠ¡æ‰§è¡Œæµç¨‹
- ğŸ«å…«ã€DyLinearæ¨¡å—çš„è¿ç®—æœºåˆ¶
- â“ä¹ã€å¦‚ä½•åœ¨æ–°æ•°æ®é›†ä¸Šä½¿ç”¨ï¼Ÿ

<!--
You can have `style` tag in markdown to override the style for the current page.
Learn more: https://sli.dev/features/slide-scope-style
-->

<style>
h1 {
  background-color: #2B90B6;
  background-image: linear-gradient(45deg, #4EC5D4 10%, #146b8c 20%);
  background-size: 100%;
  -webkit-background-clip: text;
  -moz-background-clip: text;
  -webkit-text-fill-color: transparent;
  -moz-text-fill-color: transparent;
}
</style>

<!--
Here is another comment.
-->

---
transition: slide-up
level: 2
---

# ä¸€ã€è¾“å…¥æ ¼å¼çš„ç»Ÿä¸€ä¸é€‚é…

æ—¶é—´åºåˆ—æ•°æ®å¾€å¾€å­˜åœ¨å¤šç§å¤æ‚æƒ…å†µ

- é•¿åº¦ä¸ç»Ÿä¸€ï¼šä¸åŒè¡Œä¸ºä¸»ä½“ã€ä¸åŒæ•°æ®é›†çš„åºåˆ—é•¿åº¦ t å¯èƒ½å·®åˆ«å·¨å¤§ï¼ˆä¾‹å¦‚æœ‰çš„åºåˆ—æ˜¯100ä¸ªæ—¶é—´ç‚¹ï¼Œæœ‰çš„æ˜¯1000ä¸ªæ—¶é—´ç‚¹ï¼‰ã€‚
- é€šé“æ•°ï¼ˆå˜é‡æ•°ï¼‰ä¸ç»Ÿä¸€ï¼šæœ‰çš„æ—¶é—´åºåˆ—åªæœ‰1ä¸ªå˜é‡ï¼ˆä¾‹å¦‚å•æ¸©åº¦è®°å½•ï¼‰ï¼Œæœ‰çš„å¯èƒ½æœ‰æ•°åç”šè‡³æ•°ç™¾ä¸ªå˜é‡ï¼ˆä¾‹å¦‚å¤šä¼ æ„Ÿå™¨è®°å½•ï¼‰ã€‚
- å¼‚è´¨æ€§ï¼šæ¥è‡ªä¸åŒæ•°æ®é›†çš„æ—¶é—´åºåˆ—å¯èƒ½é‡‡æ ·ç‡ã€æ•°æ®åˆ†å¸ƒã€å˜é‡ç±»å‹éƒ½æœ‰å·®å¼‚ã€‚
UNITSå¦‚ä½•ç»Ÿä¸€ä¸åŒé•¿åº¦å’Œä¸åŒé€šé“æ•°çš„è¾“å…¥ï¼Ÿ

---

## UNITSå¦‚ä½•ç»Ÿä¸€ä¸åŒé•¿åº¦å’Œä¸åŒé€šé“æ•°çš„è¾“å…¥ï¼Ÿ

**1.çº¿æ€§æŠ•å½±ï¼ˆEmbeddingï¼‰ä¸Patchåˆ‡åˆ†ï¼š**

è¾“å…¥çš„æ—¶é—´åºåˆ—æ•°æ®ä¸º $x âˆˆ R^{tÃ—v}$ï¼Œå…¶ä¸­ $t$ æ˜¯æ—¶é—´é•¿åº¦ï¼Œ$v$ æ˜¯å˜é‡æ•°ã€‚UNITSå¯¹è¾“å…¥å…ˆè¿›è¡Œåˆ†ç‰‡ï¼ˆpatchingï¼‰ï¼Œå³å°†æ—¶é—´åºåˆ—æ²¿æ—¶é—´ç»´åº¦åˆ†å‰²æˆå›ºå®šå¤§å°ä¸º $k$ çš„ä¸é‡å ç‰‡æ®µï¼Œä»è€Œå¾—åˆ° $s = t/k$ ä¸ªç‰‡æ®µï¼ˆå¦‚æœ $t$ ä¸æ˜¯ $k$ çš„æ•´æ•°å€ï¼Œä¸€èˆ¬ä¼šé€šè¿‡æˆªæ–­æˆ–paddingæ–¹å¼å¯¹é½ï¼‰ã€‚æ¯ä¸ªç‰‡æ®µæ˜¯ä¸€ä¸ª $vÃ—k$ çš„å°å—ï¼Œç„¶åé€šè¿‡çº¿æ€§æŠ•å½±å°†è¿™ä¸ªç‰‡æ®µæ˜ å°„ä¸ºä¸€ä¸ªéšè—ç»´åº¦ $d$ çš„è¡¨ç¤ºå‘é‡ã€‚

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæ— è®ºåŸå§‹åºåˆ—é•¿åº¦ $t$ å¤šé•¿ï¼Œæœ€ç»ˆéƒ½ä¼šè¢«åˆ†å‰²å¹¶æŠ•å½±åˆ°ç»Ÿä¸€çš„è¡¨ç¤ºç©ºé—´ä¸­ï¼Œä½¿å¾—æ¨¡å‹åœ¨è¾“å…¥å±‚é¢å…·æœ‰ç»Ÿä¸€æ ¼å¼ï¼š$(sä¸ªæ—¶é—´ç‰‡æ®µ) Ã— (vä¸ªå˜é‡) Ã— (dç»´éšè—è¡¨ç¤º)$ã€‚è¿™æ ·ï¼Œé•¿åº¦å’Œå˜é‡æ•°çš„å·®å¼‚é€šè¿‡æŸ”æ€§åˆ‡ç‰‡å’Œçº¿æ€§æŠ•å½±ç»Ÿä¸€åˆ°åŒä¸€ä¸ªå½¢çŠ¶ç©ºé—´ä¸­ï¼ˆå½“ç„¶ $v$ ä»å¯å˜ï¼Œä½†æ¨¡å‹åœ¨è‡ªæ³¨æ„åŠ›å±‚ä¼šå¤„ç†å¯å˜é•¿åº¦å’Œå¯å˜é€šé“æ•°ï¼‰ã€‚

**2.åŠ¨æ€çº¿æ€§å±‚ (DyLinear) ä¸å¯å˜é•¿åº¦é€‚é…ï¼š**

ç”±äºè¾“å…¥åºåˆ—é•¿åº¦å¯å˜ï¼Œæ¨¡å‹ä¸­å¼•å…¥ DyLinear æ¨¡å—ï¼ˆåŠ¨æ€çº¿æ€§æ“ä½œç¬¦ï¼‰ã€‚DyLinearé€šè¿‡åœ¨å‰é¦ˆå±‚ä¸­ä½¿ç”¨å¯¹ä¸åŒæ—¶é—´é•¿åº¦å‚æ•°çš„åŠ æƒæ¥é€‚åº”ä¸åŒé•¿åº¦è¾“å…¥ï¼Œä»¥æ•è·ä¸åŒæ—¶é—´å°ºåº¦çš„ç‰¹å¾ã€‚è¿™è®©æ¨¡å‹åœ¨ä¸­é—´ç‰¹å¾æå–é˜¶æ®µæ‹¥æœ‰æŸ”æ€§é€‚é…èƒ½åŠ›ï¼šå³ä½¿è¾“å…¥åºåˆ—é•¿åº¦å˜åŒ–ï¼Œæ¨¡å‹å¯é€šè¿‡åŠ¨æ€å‚æ•°æ’å€¼å¯¹ç‰¹å¾è¿›è¡Œé€‚é…ã€‚

è¿™ç§æœºåˆ¶ä½¿å¾—UNITSä¸ä¼šå› ä¸ºé•¿åº¦å˜åŒ–è€Œéœ€è¦é‡æ–°è®¾è®¡æ¨¡å‹ç»“æ„ï¼Œä»è€Œå®ç°å¯¹å¼‚æ„æ—¶é—´åºåˆ—çš„ç»Ÿä¸€å¤„ç†ã€‚

---

## UNITSå¦‚ä½•ç»Ÿä¸€ä¸åŒé•¿åº¦å’Œä¸åŒé€šé“æ•°çš„è¾“å…¥ï¼Ÿ

**3.æ³¨æ„åŠ›ï¼ˆæ—¶é—´ç»´ä¸å˜é‡ç»´ï¼‰ï¼š**

æ¨¡å‹é‡‡ç”¨åœ¨æ—¶é—´ç»´å’Œå˜é‡ç»´ä¸Šçš„è‡ªæ³¨æ„åŠ›æœºåˆ¶ï¼ˆå¯çœ‹ä½œæ—¶åºç»´å’Œç‰¹å¾ç»´çš„åˆ†è§£å¼æ³¨æ„åŠ›ï¼‰ã€‚è¿™æ ·ä¸€æ¥ï¼Œæ— è®º $v$ æœ‰å¤šå¤§æˆ–è€… $t$ æœ‰å¤šå¤§ï¼Œæ¨¡å‹éƒ½å¯ä»¥é€šè¿‡æ³¨æ„åŠ›æœºåˆ¶ä»è¡Œä¸åˆ—ä¸¤ä¸ªæ–¹å‘æ•æ‰ç›¸å…³æ€§ï¼Œä»è€Œç»Ÿä¸€å¤„ç†ä¸åŒå˜é‡æ•°å’Œä¸åŒåºåˆ—é•¿åº¦çš„æ•°æ®ã€‚è¿™ç§æ³¨æ„åŠ›è®©æ¨¡å‹å¯¹å˜é‡æ•°çš„å˜åŒ–åŒæ ·å…·æœ‰é€‚åº”æ€§ï¼Œå› ä¸ºæ³¨æ„åŠ›æœºåˆ¶å¯¹åºåˆ—é•¿åº¦ä¸é€šé“æ•°ä¸åšç‰¹å®šè¦æ±‚ï¼Œåªéœ€å¯¹è¾“å…¥å¼ é‡è¿›è¡Œç›¸åº”çš„åŠ æƒæ±‚å’Œä¸æ˜ å°„ã€‚

>æ€»ç»“ï¼šé€šè¿‡ä¸Šè¿°æ–¹æ³•ï¼ŒUNITSåœ¨è¾“å…¥å±‚é¢å°†å„ç§å½¢æ€ä¸ä¸€çš„æ—¶é—´åºåˆ—ï¼ˆå¤šæ ·çš„ t å’Œ vï¼‰ç»Ÿä¸€ä¸ºå¯å¤„ç†çš„æ ‡å‡†åŒ–æ ¼å¼ï¼ˆpatch embedding + attention + DyLinearï¼‰ï¼Œä»è€Œè¾¾åˆ°â€œè¾“å…¥æ ¼å¼ç»Ÿä¸€â€çš„ç›®çš„ã€‚

---

# äºŒã€UNITSçš„æ¨¡å‹ç»“æ„åŠå„éƒ¨åˆ†ä½œç”¨

æ•´ä½“ç»“æ„æ¦‚è§ˆï¼š

- ç¼–ç  (Embedding)å±‚ï¼šå¯¹åŸå§‹æ—¶é—´åºåˆ—åˆ†ç‰‡åæŠ•å½±åˆ°éšè—ç©ºé—´ã€‚
- æç¤ºæ ‡è®° (Prompt Tokens)ï¼šåœ¨è¾“å…¥åºåˆ—å‰æ³¨å…¥æç¤ºæ ‡è®°ï¼Œç”¨äºç‰¹å®šä»»åŠ¡çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
- ä»»åŠ¡æ ‡è®° (Task Tokens)ï¼šGENæ ‡è®°å’ŒCLSæ ‡è®°ç”¨äºç¡®å®šä»»åŠ¡ç±»å‹å’Œè¾“å‡ºæ¨¡å¼ã€‚
- è‡ªæ³¨æ„åŠ›æ¨¡å— (Time & Variable Attention)ï¼šåœ¨æ—¶é—´å’Œå˜é‡ä¸¤ä¸ªç»´åº¦å®æ–½æ³¨æ„åŠ›è®¡ç®—ï¼Œä»¥æ•è·æ—¶åºå’Œç‰¹å¾å…³è”ã€‚
- DyLinearæ¨¡å—ï¼šåœ¨å‰é¦ˆå±‚ä¸­æ ¹æ®è¾“å…¥é•¿åº¦åŠ¨æ€è°ƒæ•´å‚æ•°ï¼ŒåŠ å¼ºæ¨¡å‹å¯¹å¤šå°ºåº¦åºåˆ—çš„é€‚åº”æ€§ã€‚
- é—¨æ§æ¨¡å—(Gating)ï¼šåœ¨å„å±‚è¾“å‡ºåä½¿ç”¨é—¨æ§æœºåˆ¶å¯¹ç‰¹å¾è¿›è¡Œå†å¹³è¡¡ã€‚
- ç”Ÿæˆå¡”(Generative Tower) & åˆ†ç±»å¡”(Classification Tower)ï¼šå…±äº«å‚æ•°çš„é«˜å±‚æ¨¡å—ï¼Œç”¨äºæœ€ç»ˆçš„ç”Ÿæˆæˆ–åˆ†ç±»ä»»åŠ¡è¾“å‡ºã€‚

---

## å„éƒ¨åˆ†ä½œç”¨

- Embeddingå’ŒPatchåˆ†å‰²ï¼šå°†åŸå§‹åºåˆ—è½¬åŒ–ä¸ºå¯å¤„ç†çš„å›ºå®šç»´åº¦è¡¨ç¤ºï¼Œä»¥é€‚é…Transformerç»“æ„ã€‚
  
- Prompt Tokensï¼šåœ¨è¾“å…¥åºåˆ—å‰åé¢„ç½®æç¤ºæ ‡è®°ï¼Œè®©æ¨¡å‹é€šè¿‡ä¸Šä¸‹æ–‡æç¤ºäº†è§£å…·ä½“ä»»åŠ¡ã€æ•°æ®æ¥æºæˆ–ç‰¹å®šé¢†åŸŸä¿¡æ¯ã€‚è¿™ç§æç¤ºä½¿å¾—åŒä¸€æ¨¡å‹åœ¨å†»ç»“å‚æ•°çš„æƒ…å†µä¸‹ä¹Ÿèƒ½å¿«é€Ÿè½¬å‘æ–°çš„ä»»åŠ¡æˆ–æ•°æ®é›†ã€‚
  
- Task Tokensï¼š
  - GENæ ‡è®°ï¼šè¡¨ç¤ºéœ€è¦è¿›è¡Œç”Ÿæˆç±»ä»»åŠ¡ï¼Œæ¯”å¦‚é¢„æµ‹æœªæ¥å€¼æˆ–å¡«è¡¥ç¼ºå¤±ç‚¹ã€‚
  - CLSæ ‡è®°ï¼šè¡¨ç¤ºéœ€è¦æ‰§è¡Œåˆ†ç±»ç±»ä»»åŠ¡ï¼Œä¾‹å¦‚åˆ¤æ–­åºåˆ—å±äºå“ªä¸ªç±»åˆ«ã€‚
  >Task Tokenså¯ä»¥çœ‹ä½œå¯¹æ¨¡å‹çš„â€œæŒ‡ä»¤æç¤ºâ€ï¼Œå‘Šè¯‰æ¨¡å‹å½“å‰çš„è¾“å‡ºéœ€æ±‚æ˜¯åºåˆ—å€¼é‡å»ºï¼ˆç”Ÿæˆï¼‰è¿˜æ˜¯ç±»åˆ«åˆ¤æ–­ï¼ˆåˆ†ç±»ï¼‰ã€‚

---

## å„éƒ¨åˆ†ä½œç”¨

- æ—¶é—´ä¸å˜é‡è‡ªæ³¨æ„åŠ›æ¨¡å—ï¼šé€šè¿‡å¯¹æ—¶é—´ç»´ã€å˜é‡ç»´åˆ†åˆ«è¿›è¡Œæ³¨æ„åŠ›è®¡ç®—ï¼Œæå–å…¨é¢çš„æ—¶åº-ç‰¹å¾äº¤äº’å…³ç³»ï¼Œä½¿æ¨¡å‹èƒ½å¯¹ä»»æ„å½¢çŠ¶çš„æ—¶åºæ•°æ®è¿›è¡Œæœ‰æ•ˆå»ºæ¨¡ã€‚
- DyLinearï¼šåŠ¨æ€é€‚é…ä¸åŒé•¿åº¦çš„è¾“å…¥ï¼Œä¸ºå¤šå°ºåº¦çš„æ—¶åºæ•°æ®æä¾›ç»Ÿä¸€çš„ç‰¹å¾æå–èƒ½åŠ›ã€‚
- é—¨æ§æ¨¡å—(Gating)ï¼šå¯¹å¤šä»»åŠ¡æ•°æ®æ··åˆè®­ç»ƒæƒ…å†µä¸‹çš„ç‰¹å¾æ‰°åŠ¨è¿›è¡Œè°ƒèŠ‚ã€‚é—¨æ§æ¨¡å—å¯ä»¥å‡å°‘å™ªå£°ç‰¹å¾æˆ–æ— å…³ç‰¹å¾çš„å½±å“ï¼Œæå‡æ¨¡å‹åœ¨ç»Ÿä¸€æ¡†æ¶ä¸‹å¤„ç†å¤šç§ä»»åŠ¡çš„ç¨³å®šæ€§ã€‚
- ç”Ÿæˆå¡” & åˆ†ç±»å¡”ï¼šåœ¨æ¨¡å‹é¡¶å±‚ï¼Œç±»ä¼¼äºåˆ†ç±»æ¨¡å‹ä¸­å¸¸è§çš„åˆ†ç±»å¤´ï¼Œä»¥å…±äº«æƒé‡çš„æ–¹å¼å­˜åœ¨ã€‚æ¨¡å‹ä¸éœ€è¦ä¸ºæ¯ç§ä»»åŠ¡è®¾è®¡ç‹¬ç«‹çš„å¤´éƒ¨ç»“æ„ï¼Œè€Œæ˜¯é€šè¿‡ä»»åŠ¡æ ‡è®°æŒ‡ç¤ºï¼ŒåŠ¨æ€ä½¿ç”¨ç”Ÿæˆå¡”æˆ–åˆ†ç±»å¡”çš„èƒ½åŠ›ï¼Œä¸ºå¤šç±»å‹ä»»åŠ¡ç»Ÿä¸€è¾“å‡ºç»“æœã€‚


---

# ä¸‰ã€Prompt Learningçš„ä½œç”¨
é€šè¿‡promptå®ç°unseençš„æ¨æ–­

Prompt Learningåœ¨UNITSä¸­çš„æ„ä¹‰ï¼š
åœ¨è¯­è¨€æ¨¡å‹ä¸­ï¼ŒPrompt Learningé€šè¿‡åœ¨è¾“å…¥æ–‡æœ¬ä¸­æ·»åŠ æç¤ºï¼Œè®©å·²ç»è®­ç»ƒå¥½çš„æ¨¡å‹åœ¨æ— éœ€å¤§é‡é¢å¤–å‚æ•°æˆ–å¾®è°ƒçš„æƒ…å†µä¸‹è¿›è¡Œæ–°ä»»åŠ¡ã€‚UNITSå°†è¿™ä¸€ç†å¿µç§»æ¤åˆ°æ—¶é—´åºåˆ—é¢†åŸŸã€‚

é€šè¿‡åœ¨è¾“å…¥åºåˆ—ä¸­æ·»åŠ æç¤ºæ ‡è®°ï¼ˆPrompt Tokensï¼‰ï¼ŒUNITSå¯ä»¥åœ¨æ— éœ€é‡æ–°è®­ç»ƒæ•´ä¸ªæ¨¡å‹çš„æƒ…å†µä¸‹é€‚é…æ–°ä»»åŠ¡ã€æ–°æ•°æ®é›†æˆ–æ–°æ•°æ®åŸŸã€‚è¿™äº›æç¤ºæ ‡è®°å¯ä»¥æ˜¯é¢„å…ˆå­¦ä¹ å¾—åˆ°çš„åµŒå…¥å‘é‡ï¼Œèƒ½å¤Ÿï¼š
- ä¸ºç‰¹å®šæ•°æ®é›†æä¾›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼ˆä¾‹å¦‚æ•°æ®æ‰€å±é¢†åŸŸæˆ–ä¼ æ„Ÿå™¨ç±»å‹ï¼‰ã€‚
- å¼•å¯¼æ¨¡å‹åœ¨æ¨æ–­æ—¶é‡ç‚¹å…³æ³¨åºåˆ—ä¸­ä¸å½“å‰ä»»åŠ¡æœ€ç›¸å…³çš„ç‰¹å¾æˆ–æ—¶é—´æ®µã€‚
- åœ¨å¤šä»»åŠ¡åœºæ™¯ä¸­ï¼Œé€šè¿‡ä¸åŒçš„æç¤ºæ ‡è®°å¿«é€Ÿåˆ‡æ¢ä»»åŠ¡è¦æ±‚ã€‚
- å› ä¸ºæç¤ºæ ‡è®°æ˜¯å¯å­¦ä¹ çš„åµŒå…¥ï¼Œå…¶è®­ç»ƒå¯ä»¥åœ¨æ¨¡å‹å‚æ•°å†»ç»“çš„çŠ¶æ€ä¸‹è¿›è¡Œï¼Œä½¿å¾—å¯¹æ–°ä»»åŠ¡çš„é€‚é…æˆæœ¬æä½ï¼ˆç±»ä¼¼äºåœ¨LLMä¸­æ·»åŠ å°‘é‡Soft Promptså¼•å¯¼ä»»åŠ¡ï¼‰ã€‚

---

# ä¸‰ã€Prompt Learningçš„ä½œç”¨
**Prompt Learning**åœ¨UNITSä¸­æ‰®æ¼”ç€å…³é”®è§’è‰²ï¼Œé€šè¿‡ä»»åŠ¡æ ‡è®°åŒ–å’Œæç¤ºæ ‡è®°åŒ–ï¼Œå®ç°æ¨¡å‹å¯¹ä¸åŒä»»åŠ¡çš„çµæ´»é€‚é…ã€‚

ä»»åŠ¡ä¸Šä¸‹æ–‡æä¾›ï¼š

é€šè¿‡æç¤ºæ ‡è®° $z_p$ï¼Œæ¨¡å‹è·å¾—å½“å‰ä»»åŠ¡æˆ–æ•°æ®é›†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œä¸åŒæ•°æ®é›†å¯èƒ½å…·æœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œæç¤ºæ ‡è®°å¸®åŠ©æ¨¡å‹ç†è§£è¿™äº›ç‰¹æ€§ã€‚

ä»»åŠ¡æŒ‡ä»¤å¼•å¯¼ï¼š
ä»»åŠ¡æ ‡è®°ï¼ˆGENæˆ–CLSï¼‰å‘æ¨¡å‹ä¼ è¾¾å½“å‰ä»»åŠ¡çš„å…·ä½“è¦æ±‚ã€‚æ¯”å¦‚ï¼ŒGENæ ‡è®°æŒ‡ç¤ºç”Ÿæˆä»»åŠ¡ï¼ŒCLSæ ‡è®°æŒ‡ç¤ºåˆ†ç±»ä»»åŠ¡ã€‚

å†»ç»“æ¨¡å‹å‚æ•°è¿›è¡Œå¿«é€Ÿé€‚é…ï¼š
é€šè¿‡æç¤ºæ ‡è®°å’Œä»»åŠ¡æ ‡è®°ï¼Œæ¨¡å‹åœ¨å‚æ•°å†»ç»“çš„æƒ…å†µä¸‹å³å¯é€‚é…æ–°ä»»åŠ¡ï¼Œæ— éœ€é‡æ–°è®­ç»ƒæˆ–å¤§è§„æ¨¡å¾®è°ƒã€‚

æ”¯æŒå°‘æ ·æœ¬å­¦ä¹ ï¼š
æç¤ºå­¦ä¹ ä½¿æ¨¡å‹åœ¨å°‘é‡æ ·æœ¬çš„æƒ…å†µä¸‹å¿«é€Ÿé€‚é…æ–°ä»»åŠ¡ï¼Œé€šè¿‡æç¤ºæ ‡è®°æä¾›æœ‰æ•ˆçš„ä»»åŠ¡æŒ‡å¼•ã€‚

>æ€»ç»“ï¼šPrompt Learningä½¿UNITSèƒ½å¤Ÿåœ¨ç»Ÿä¸€çš„æ¨¡å‹æ¶æ„ä¸‹é«˜æ•ˆå¤„ç†å¤šç§ä»»åŠ¡ï¼Œé€šè¿‡ä»»åŠ¡å’Œæç¤ºæ ‡è®°æä¾›çµæ´»çš„ä»»åŠ¡é€‚é…æœºåˆ¶ï¼Œæå‡æ¨¡å‹çš„é€šç”¨æ€§å’Œé€‚åº”æ€§ã€‚
---

# å››ã€æ ‡è®°ç±»å‹çš„æ¥æºã€æ ¼å¼ä¸å®ç°
åœ¨UNITSä¸­æœ‰ä¸‰ç±»æ ‡è®°ï¼šæ ·æœ¬æ ‡è®°ã€æç¤ºæ ‡è®°ã€ä»»åŠ¡æ ‡è®°ã€‚

## æ ·æœ¬æ ‡è®°ï¼ˆSample Tokensï¼‰
æ¥æºä¸æ ¼å¼ï¼š
æ ·æœ¬æ ‡è®°ç›´æ¥æ¥è‡ªåŸå§‹æ—¶é—´åºåˆ—æ•°æ® $x âˆˆ R^{tÃ—v}$ã€‚é€šè¿‡å°†æ—¶é—´åºåˆ—æ²¿æ—¶é—´è½´åˆ†å‰²æˆé•¿åº¦ä¸º $k$ çš„ç‰‡æ®µï¼Œå…±å¾—åˆ° $s = t/k$ ä¸ªæ—¶é—´å—ã€‚æ¯ä¸ªæ—¶é—´å—å¤§å°ä¸º $(vÃ—k)$ çš„ç‰‡æ®µï¼Œé€šè¿‡çº¿æ€§æ˜ å°„æ˜ å°„ä¸º $(vÃ—d)$ çš„éšè—è¡¨ç¤ºã€‚è¿™é‡Œçš„ $v$ æ˜¯å˜é‡æ•°ã€$d$ æ˜¯æ¨¡å‹éšè—ç»´åº¦ã€‚
ç»è¿‡è¿™ç§å¤„ç†åï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ ·æœ¬æ ‡è®°é›†åˆä¸º $z_x âˆˆ R^{sÃ—vÃ—d}$ï¼Œå³ $s$ ä¸ªæ—¶é—´ç‰‡æ®µï¼Œæ¯ä¸ªç‰‡æ®µæ‹¥æœ‰ $v$ ä¸ªå˜é‡ï¼Œæ¯ä¸ªå˜é‡æ˜ å°„åˆ° $d$ ç»´çš„å‘é‡ç©ºé—´ä¸­ã€‚
å®ç°ï¼š
åœ¨ä»£ç å®ç°ä¸­ï¼Œè¿™é€šå¸¸æ˜¯æ•°æ®è¾“å…¥å±‚çš„æ“ä½œã€‚ä¾‹å¦‚ï¼š
```python
# x: [batch, t, v]
# åˆ’åˆ†ç‰‡æ®µ
x_patches = x.reshape(batch, s, k, v)  # é‡å¡‘ä¸º s ä¸ª (kÃ—v)çš„block
# å¯¹æ¯ä¸ªæ—¶é—´ç‰‡æ®µè¿›è¡Œçº¿æ€§æŠ•å½±
z_x = linear_projection(x_patches)  # å¾—åˆ° [batch, s, v, d]
```
åŒæ—¶è¿˜å¯ä»¥åŠ å…¥å¯å­¦ä¹ çš„ä½ç½®ç¼–ç ï¼Œä¸ºæ¯ä¸ªæ—¶é—´ç‰‡æ®µå¢åŠ ä½ç½®ä¿¡æ¯ã€‚

---

## æç¤ºæ ‡è®°ï¼ˆPrompt Tokensï¼‰
æ¥æºä¸æ ¼å¼ï¼š
æç¤ºæ ‡è®° $z_p âˆˆ R^{pÃ—vÃ—d}$ æ˜¯æ¨¡å‹ä¸­å¯å­¦ä¹ çš„å‚æ•°ï¼Œç‹¬ç«‹äºè¾“å…¥æ•°æ®ï¼Œå¯è§†ä¸ºæ¨¡å‹çš„â€œè®°å¿†æ§½â€æˆ–â€œä¸Šä¸‹æ–‡è¯´æ˜â€ã€‚è¿™äº›æç¤ºåœ¨è®­ç»ƒä¸­é€šè¿‡æ¢¯åº¦æ›´æ–°å­¦ä¹ å¾—åˆ°ã€‚
åœ¨å¤šä»»åŠ¡åœºæ™¯ä¸­ï¼Œä¸åŒæ•°æ®é›†æˆ–ä»»åŠ¡å¯åˆ†é…ä¸åŒçš„æç¤ºæ ‡è®°ï¼Œä»¥ä½¿æ¨¡å‹åœ¨å¤„ç†ç‰¹å®šæ•°æ®æ—¶å…·å¤‡å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
å®ç°ï¼š
æç¤ºæ ‡è®°åœ¨å®ç°ä¸Šé€šå¸¸æ˜¯æ¨¡å‹å†…éƒ¨å®šä¹‰çš„å¯è®­ç»ƒå‚æ•°çŸ©é˜µã€‚ä¾‹å¦‚ï¼š
```python
self.prompt_tokens = nn.Parameter(torch.randn(p, v, d))
```
æ¨ç†æ—¶å°†å…¶ä¸æ ·æœ¬æ ‡è®°æ‹¼æ¥èµ·æ¥è¾“å…¥æ¨¡å‹ï¼š
```python
input_sequence = torch.cat([self.prompt_tokens, z_x], dim=0)
```

---

## ä»»åŠ¡æ ‡è®°ï¼ˆTask Tokensï¼‰
æ¥æºä¸æ ¼å¼ï¼š
ä»»åŠ¡æ ‡è®°åŒ…æ‹¬ GEN å’Œ CLS ä¸¤ç§ç±»å‹ã€‚å…¶ä¸­ï¼š
GEN æ ‡è®°ç”¨äºç”Ÿæˆç±»ä»»åŠ¡ï¼Œä¾‹å¦‚é¢„æµ‹æœªæ¥å€¼ã€æ•°æ®å¡«è¡¥æˆ–å¼‚å¸¸æ£€æµ‹ã€‚å¯¹äºé¢„æµ‹æœªæ¥ $f$ æ­¥ï¼Œå¯å¤åˆ¶ GEN æ ‡è®° $f$ æ¬¡ä½œä¸ºç”Ÿæˆçš„â€œæŸ¥è¯¢â€ã€‚
CLS æ ‡è®°ç”¨äºåˆ†ç±»ä»»åŠ¡ã€‚è‹¥æœ‰ $C$ ä¸ªç±»åˆ«ï¼Œå¯è®¾å®šç›¸åº”æ•°é‡çš„ CLS æ ‡è®°ï¼Œä»¥å¸®åŠ©æ¨¡å‹èšåˆå¹¶è¾“å‡ºåˆ†ç±»ç»“æœã€‚
å®ç°ï¼š
ç±»ä¼¼æç¤ºæ ‡è®°ï¼Œä»»åŠ¡æ ‡è®°ä¹Ÿæ˜¯å¯å­¦ä¹ å‚æ•°ï¼Œåœ¨æ¨¡å‹ä¸­å®šä¹‰ä¸ºåµŒå…¥å‘é‡ï¼š
```python
self.gen_token = nn.Parameter(torch.randn(1, v, d)) # å•ä¸ªGENæ ‡è®°ï¼Œå¯é‡å¤ä½¿ç”¨fæ¬¡
self.cls_tokens = nn.Parameter(torch.randn(C, v, d)) # Cä¸ªCLSæ ‡è®°
```
åœ¨è¾“å…¥æ—¶å°†ä»»åŠ¡æ ‡è®°ä¸æ ·æœ¬æ ‡è®°ã€æç¤ºæ ‡è®°æ‹¼æ¥èµ·æ¥å¾—åˆ°æœ€ç»ˆçš„è¾“å…¥åºåˆ—ï¼š
```python
# å¯¹äºé¢„æµ‹ä»»åŠ¡ï¼Œéœ€è¦fä¸ªGENæ ‡è®°:
gen_tokens = self.gen_token.repeat(f, 1, 1)
# æœ€ç»ˆè¾“å…¥:
input_sequence = torch.cat([self.prompt_tokens, z_x, gen_tokens], dim=0)
```
é€šè¿‡ä¸Šè¿°æ ‡è®°ä½“ç³»ï¼ŒUNITSå¯ä»¥çµæ´»åœ°åœ¨åŒä¸€ä¸ªæ¨¡å‹è¾“å…¥ç«¯æ·»åŠ ä¸åŒçš„æ ‡è®°ï¼Œä»è€Œå®ç°å¯¹å¤šæ ·ä»»åŠ¡çš„ç»Ÿä¸€æœ¬è´¨åŒ–è¡¨ç¤ºã€‚Prompt Tokensä¸ºä¸Šä¸‹æ–‡ï¼ŒSample Tokensä¸ºæ•°æ®å†…å®¹ï¼ŒTask Tokensä¸ºç›®æ ‡ä»»åŠ¡çš„ä¿¡å·ï¼Œè¿™ä¸‰è€…ç»“åˆï¼Œä½¿å¾—UNITSåœ¨å¤„ç†ä»»æ„æ—¶é—´åºåˆ—ä»»åŠ¡æ—¶ï¼Œéƒ½èƒ½ä»¥ç»Ÿä¸€æ ¼å¼è¿›è¡Œå»ºæ¨¡ã€‚

---

# äº”ã€GEN towerå’ŒCLS toweråˆ†åˆ«æœ‰ä»€ä¹ˆç”¨å¤„ï¼Ÿ
ç±»ä¼¼ç›®æ ‡æ£€æµ‹æ¨¡å‹ä¸­çš„åˆ†ç±»å¤´

**GENå¡”ï¼š**

ç”¨é€”ï¼šä¸»è¦ç”¨äºç”Ÿæˆç±»ä»»åŠ¡ï¼Œå¦‚æ—¶é—´åºåˆ—é¢„æµ‹ã€æ•°æ®å¡«å……å’Œå¼‚å¸¸æ£€æµ‹ã€‚è¿™äº›ä»»åŠ¡éœ€è¦ç”Ÿæˆæ–°çš„æ—¶é—´åºåˆ—æ•°æ®æˆ–é¢„æµ‹æœªæ¥çš„å€¼ã€‚

å·¥ä½œæœºåˆ¶ï¼šåœ¨ç”Ÿæˆä»»åŠ¡ä¸­ï¼ŒGENå¡”è´Ÿè´£å¤„ç†è¾“å…¥çš„æ ·æœ¬æ ‡è®°å’Œä»»åŠ¡æ ‡è®°ï¼ˆGENæ ‡è®°ï¼‰ï¼Œé€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶å’ŒåŠ¨æ€çº¿æ€§æ¨¡å—ç”Ÿæˆæ‰€éœ€çš„è¾“å‡ºã€‚ä¾‹å¦‚ï¼Œåœ¨é¢„æµ‹ä»»åŠ¡ä¸­ï¼ŒGENå¡”ä¼šæ ¹æ®è¾“å…¥çš„å†å²æ•°æ®ç”Ÿæˆæœªæ¥çš„é¢„æµ‹å€¼ã€‚

**CLSå¡”ï¼š**

ç”¨é€”ï¼šä¸»è¦ç”¨äºåˆ†ç±»ä»»åŠ¡ï¼Œå¯¹æ•´ä¸ªæ—¶é—´åºåˆ—æ ·æœ¬è¿›è¡Œåˆ†ç±»ã€‚è¿™ç±»ä»»åŠ¡éœ€è¦å°†è¾“å…¥çš„æ—¶é—´åºåˆ—æ˜ å°„åˆ°é¢„å®šä¹‰çš„ç±»åˆ«ä¸­ã€‚

å·¥ä½œæœºåˆ¶ï¼šåœ¨åˆ†ç±»ä»»åŠ¡ä¸­ï¼ŒCLSå¡”å¤„ç†æ ·æœ¬æ ‡è®°å’Œä»»åŠ¡æ ‡è®°ï¼ˆCLSæ ‡è®°ï¼‰ï¼Œé€šè¿‡è‡ªæ³¨æ„åŠ›æœºåˆ¶å’Œé—¨æ§æ¨¡å—æå–ç‰¹å¾ï¼Œå¹¶æœ€ç»ˆè¾“å‡ºåˆ†ç±»ç»“æœã€‚CLSå¡”é€šè¿‡ä¸ç±»åˆ«åµŒå…¥çš„å¯¹æ¯”æ¥ç¡®å®šæ ·æœ¬æ‰€å±çš„ç±»åˆ«ã€‚
>æ€»ç»“ï¼šGENå¡”å’ŒCLSå¡”é€šè¿‡å…±äº«æ¨¡å‹çš„åº•å±‚è¡¨ç¤ºï¼ˆå¦‚è‡ªæ³¨æ„åŠ›å±‚å’ŒDyLinearæ¨¡å—ï¼‰ï¼Œåˆ†åˆ«ä¼˜åŒ–ç”Ÿæˆå’Œåˆ†ç±»ä»»åŠ¡ï¼Œç¡®ä¿åœ¨ç»Ÿä¸€çš„æ¡†æ¶ä¸‹é«˜æ•ˆå¤„ç†å¤šç§ä»»åŠ¡ç±»å‹ã€‚

---

# å…­ã€æ•°æ®é¢„å¤„ç†
åŸå§‹æ—¶é—´åºåˆ—æ•°æ®ï¼šå½¢å¼ä¸º $x âˆˆ R^{tÃ—v}$ï¼Œå…¶ä¸­ $t$ æ˜¯æ—¶é—´æ­¥æ•°ï¼Œ$v$ æ˜¯å˜é‡æ•°ã€‚

**æ ·æœ¬æ ‡è®°åŒ–ï¼ˆSample Tokenizationï¼‰ï¼š**

- **åˆ‡åˆ†**ï¼šå°†æ—¶é—´åºåˆ—æ²¿æ—¶é—´ç»´åº¦åˆ†å‰²æˆå›ºå®šå¤§å°ä¸º $k$ çš„ä¸é‡å ç‰‡æ®µï¼Œå¾—åˆ° $s = \frac{t}{k}$ ä¸ªç‰‡æ®µã€‚
- **çº¿æ€§æŠ•å½±**ï¼šæ¯ä¸ªç‰‡æ®µ $x_i âˆˆ R^{kÃ—v}$ é€šè¿‡çº¿æ€§æŠ•å½±æ˜ å°„åˆ°éšè—ç»´åº¦ $d$ï¼Œå¾—åˆ°åµŒå…¥å‘é‡ $z_x âˆˆ R^{sÃ—vÃ—d}$ã€‚
- **ä½ç½®åµŒå…¥**ï¼šä¸ºæ¯ä¸ªæ ·æœ¬æ ‡è®°æ·»åŠ å¯å­¦ä¹ çš„ä½ç½®åµŒå…¥ï¼Œæä¾›æ—¶é—´ä½ç½®ä¿¡æ¯ã€‚

**æç¤ºæ ‡è®°åŒ–ï¼ˆPrompt Tokenizationï¼‰ï¼š**

æç¤ºæ ‡è®° $z_p âˆˆ R^{pÃ—vÃ—d}$ æ˜¯å¯å­¦ä¹ çš„åµŒå…¥ï¼Œæä¾›ä»»åŠ¡æˆ–æ•°æ®é›†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

**ä»»åŠ¡æ ‡è®°åŒ–ï¼ˆTask Tokenizationï¼‰ï¼š**

- **GENæ ‡è®°**ï¼šç”¨äºç”Ÿæˆä»»åŠ¡ï¼Œæ ¹æ®é¢„æµ‹æ­¥æ•°å¤åˆ¶ç›¸åº”æ¬¡æ•°ã€‚ä¾‹å¦‚ï¼Œé¢„æµ‹5æ­¥åˆ™å¤åˆ¶5æ¬¡GENæ ‡è®°ã€‚
- **CLSæ ‡è®°**ï¼šç”¨äºåˆ†ç±»ä»»åŠ¡ï¼Œæ ¹æ®ç±»åˆ«æ•°ç›®è®¾ç½®CLSæ ‡è®°æ•°é‡ã€‚

---

# ä¸ƒã€ä»»åŠ¡æ‰§è¡Œæµç¨‹
ä»¥å¸¸è§ä»»åŠ¡ä¸ºä¾‹ï¼š

**é¢„æµ‹ä»»åŠ¡ï¼ˆForecastingï¼‰ï¼š**

è¾“å…¥ï¼šæ ·æœ¬æ ‡è®° $z_x$ï¼Œæç¤ºæ ‡è®° $z_p$ï¼ŒGENæ ‡è®°ï¼ˆå¤åˆ¶5æ¬¡æˆ–10æ¬¡ï¼‰ã€‚

æ¨¡å‹è¿ç®—ï¼šé€šè¿‡åŒå‘è‡ªæ³¨æ„åŠ›ã€DyLinearæ¨¡å—å¤„ç†è¾“å…¥ï¼ŒGENå¡”ç”Ÿæˆæœªæ¥çš„æ—¶é—´æ­¥å€¼ã€‚

è¾“å‡ºï¼šé¢„æµ‹çš„æ—¶é—´åºåˆ—å€¼ã€‚

**åˆ†ç±»ä»»åŠ¡ï¼ˆClassificationï¼‰ï¼š**

è¾“å…¥ï¼šæ ·æœ¬æ ‡è®° $z_x$ï¼Œæç¤ºæ ‡è®° $z_p$ï¼ŒCLSæ ‡è®°ï¼ˆæ ¹æ®ç±»åˆ«æ•°ç›®è®¾ç½®ï¼‰ã€‚

æ¨¡å‹è¿ç®—ï¼šé€šè¿‡åŒå‘è‡ªæ³¨æ„åŠ›ã€DyLinearæ¨¡å—å¤„ç†è¾“å…¥ï¼ŒCLSå¡”æå–ç‰¹å¾å¹¶ä¸ç±»åˆ«åµŒå…¥å¯¹æ¯”ã€‚

è¾“å‡ºï¼šåˆ†ç±»ç»“æœï¼ˆç±»åˆ«æ ‡ç­¾ï¼‰ã€‚

---

# å…«ã€DyLinearæ¨¡å—çš„è¿ç®—æœºåˆ¶
é€‚åº”ä¸åŒæ—¶é—´é•¿åº¦çš„å…³é”®

## è¿ç®—åŸç†
DyLinearæ¨¡å—çš„æ ¸å¿ƒæ€æƒ³æ˜¯æ ¹æ®è¾“å…¥åºåˆ—çš„é•¿åº¦åŠ¨æ€è°ƒæ•´çº¿æ€§å±‚çš„æƒé‡å‚æ•°ï¼Œç¡®ä¿æ¨¡å‹åœ¨å¤„ç†ä¸åŒé•¿åº¦åºåˆ—æ—¶ä¿æŒæ€§èƒ½ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š

**è¾“å…¥ç‰¹å¾**ï¼šå‡è®¾è¾“å…¥ç‰¹å¾ä¸º $h âˆˆ R^{sÃ—vÃ—d}$ï¼Œå…¶ä¸­ $s$ æ˜¯åˆ‡åˆ†åçš„ç‰‡æ®µæ•°ã€‚

**åŠ¨æ€æƒé‡ç”Ÿæˆ**ï¼š
æ ¹æ®è¾“å…¥åºåˆ—çš„é•¿åº¦ $s$ï¼Œç”ŸæˆåŠ¨æ€æƒé‡ $W_s$ã€‚
æƒé‡ç”Ÿæˆå¯ä»¥é€šè¿‡æ’å€¼æˆ–åŸºäºé•¿åº¦çš„å‚æ•°é€‰æ‹©å®ç°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ä¸€ç»„åŸºç¡€æƒé‡ï¼Œé€šè¿‡æ’å€¼è®¡ç®—å‡ºå½“å‰é•¿åº¦ä¸‹çš„æƒé‡ã€‚

**çº¿æ€§å˜æ¢**ï¼š
ä½¿ç”¨åŠ¨æ€ç”Ÿæˆçš„æƒé‡ $W_s$ å¯¹è¾“å…¥ç‰¹å¾è¿›è¡Œçº¿æ€§å˜æ¢ï¼š$h' = h â‹… W_s$
è¿™é‡Œï¼Œ$W_s$ æ˜¯ä¸€ä¸ªä¸å½“å‰é•¿åº¦ $s$ ç›¸å…³çš„æƒé‡çŸ©é˜µï¼Œç¡®ä¿çº¿æ€§å˜æ¢é€‚åº”ä¸åŒçš„åºåˆ—é•¿åº¦ã€‚
---

### ä¸¾ä¾‹è¯´æ˜
å‡è®¾æœ‰ä¸¤ç§è¾“å…¥é•¿åº¦ï¼š
- è¾“å…¥Aï¼šåºåˆ—é•¿åº¦ $s = 10$
- è¾“å…¥Bï¼šåºåˆ—é•¿åº¦ $s = 20$

DyLinearæ¨¡å—å°†æ ¹æ® $s$ åŠ¨æ€ç”Ÿæˆä¸åŒçš„æƒé‡ $W_{10}$ å’Œ $W_{20}$ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†è¾“å…¥Aå’Œè¾“å…¥Bã€‚

**å…·ä½“è¿‡ç¨‹**ï¼š

- è¾“å…¥Aï¼š
  - åºåˆ—é•¿åº¦ $s = 10$
  - ç”Ÿæˆæƒé‡ $W_{10}$ï¼ˆé€šè¿‡æ’å€¼æˆ–å‚æ•°é€‰æ‹©ï¼‰
  - è¿›è¡Œçº¿æ€§å˜æ¢ $h_A' = h_A â‹… W_{10}$
- è¾“å…¥Bï¼š
  - åºåˆ—é•¿åº¦ $s = 20$
  - ç”Ÿæˆæƒé‡ $W_{20}$
  - è¿›è¡Œçº¿æ€§å˜æ¢ $h_B' = h_B â‹… W_{20}$

---

# ä¹ã€å¦‚ä½•åœ¨æ–°æ•°æ®é›†ä¸Šä½¿ç”¨ï¼Ÿ
å¦‚ä½•å°†æç¤ºæ ‡è®°ï¼ˆPrompt Tokensï¼‰ä¸æ•°æ®é›†å…³è”ï¼Œä»¥åŠæç¤ºæ ‡è®°å¦‚ä½•åŒ…å«æ•°æ®é›†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Ÿ
**æç¤ºæ ‡è®°**åœ¨UNITSæ¨¡å‹ä¸­ç”¨äºæä¾›ä»»åŠ¡æˆ–æ•°æ®é›†çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œå¸®åŠ©æ¨¡å‹ç†è§£å½“å‰å¤„ç†çš„æ•°æ®çš„ç‰¹æ€§å’Œä»»åŠ¡è¦æ±‚ã€‚

å…³è”æ–¹å¼ï¼š
- ç‹¬ç«‹çš„æç¤ºæ ‡è®°ï¼šæ¯ä¸ªæ•°æ®é›†æˆ–ä»»åŠ¡å¯ä»¥è¢«åˆ†é…ä¸€ç»„ç‹¬ç«‹çš„æç¤ºæ ‡è®°ã€‚è¿™äº›æç¤ºæ ‡è®°æ˜¯å¯å­¦ä¹ çš„åµŒå…¥å‘é‡ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¸“é—¨å­¦ä¹ ä»¥æ•æ‰ä¸ç‰¹å®šæ•°æ®é›†æˆ–ä»»åŠ¡ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
- æ•°æ®é›†æ ‡è¯†ï¼šåœ¨å¤šæ•°æ®é›†ã€å¤šä»»åŠ¡çš„è®­ç»ƒç¯å¢ƒä¸­ï¼Œå¯ä»¥ä¸ºæ¯ä¸ªæ•°æ®é›†å®šä¹‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ªæ•°æ®é›†IDï¼‰ã€‚è¿™ä¸ªæ ‡è¯†ç¬¦è¢«ç”¨æ¥é€‰æ‹©å¯¹åº”çš„æç¤ºæ ‡è®°ã€‚è¯¥æ­¥éª¤åœ¨ä¸ºæ•°æ®é›†ç¼–å†™Configæ–‡ä»¶çš„æ—¶å€™å®Œæˆã€‚

åŒ…å«ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æœºåˆ¶ï¼š
å¯å­¦ä¹ çš„åµŒå…¥ï¼šæç¤ºæ ‡è®°ä½œä¸ºå¯å­¦ä¹ çš„åµŒå…¥å‘é‡ï¼Œåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­å­¦ä¹ åˆ°ç‰¹å®šæ•°æ®é›†çš„ç‰¹æ€§ã€‚è¿™äº›åµŒå…¥å‘é‡å¯ä»¥æ•æ‰æ•°æ®é›†çš„é¢†åŸŸçŸ¥è¯†ã€å˜é‡åˆ†å¸ƒã€é‡‡æ ·ç‡ç­‰ç‰¹å¾ã€‚
ä»»åŠ¡é€‚é…ï¼šåœ¨å¤„ç†ä¸åŒæ•°æ®é›†æ—¶ï¼Œæ¨¡å‹é€šè¿‡è¾“å…¥å¯¹åº”çš„æç¤ºæ ‡è®°ï¼Œæ¿€æ´»ä¸è¯¥æ•°æ®é›†ç›¸å…³çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½¿æ¨¡å‹èƒ½å¤Ÿæ ¹æ®æç¤ºæ ‡è®°è°ƒæ•´å…¶å†…éƒ¨è¡¨ç¤ºï¼Œä»¥æ›´å¥½åœ°é€‚åº”å½“å‰æ•°æ®é›†çš„ç‰¹æ€§ã€‚

ç”Ÿæˆæç¤ºæ ‡è®°çš„æ–¹æ³•ï¼š
åˆå§‹åŒ–ï¼šä¸ºæ¯ä¸ªæ•°æ®é›†é¢„å…ˆå®šä¹‰ä¸€ç»„å¯å­¦ä¹ çš„æç¤ºæ ‡è®°åµŒå…¥ï¼Œé€šå¸¸åœ¨æ¨¡å‹åˆå§‹åŒ–æ—¶éšæœºåˆå§‹åŒ–ã€‚
è®­ç»ƒè¿‡ç¨‹ï¼šåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé€šè¿‡åå‘ä¼ æ’­æ›´æ–°æç¤ºæ ‡è®°ï¼Œä½¿å…¶é€æ­¥å­¦ä¹ åˆ°ä¸ç‰¹å®šæ•°æ®é›†ç›¸å…³çš„æœ‰æ•ˆä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚
æ¨ç†é˜¶æ®µï¼šåœ¨æ¨ç†æ—¶ï¼Œæ ¹æ®è¾“å…¥æ•°æ®æ‰€å±çš„æ•°æ®é›†ï¼Œé€‰æ‹©ç›¸åº”çš„æç¤ºæ ‡è®°å¹¶å°†å…¶ä¸æ ·æœ¬æ ‡è®°å’Œä»»åŠ¡æ ‡è®°ä¸€èµ·è¾“å…¥æ¨¡å‹ï¼Œä»è€Œæä¾›å¿…è¦çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚

---

# UniTS
```python
class Model(nn.Module):
    """
    UniTS: Building a Unified Time Series Model
    """

    def __init__(self, args, configs_list, pretrain=False):
        super().__init__()
    def tokenize(self, x, mask=None):
    def prepare_prompt(self, x, n_vars, prefix_prompt, task_prompt, task_prompt_num, task_name=None, mask=None):
    def mark2token(self, x_mark):
    def backbone(self, x, prefix_len, seq_len):
    def forecast(self, x, x_mark, task_id):
    def classification(self, x, x_mark, task_id):
    def imputation(self, x, x_mark, mask, task_id):
    def anomaly_detection(self, x, x_mark, task_id):
    def random_masking(self, x, min_mask_ratio, max_mask_ratio):
    def right_masking(self, x, min_mask_ratio, max_mask_ratio)
    def choose_masking(self, x, right_prob, min_mask_ratio, max_mask_ratio):
    def get_mask_seq(self, mask, seq_len):
    def pretraining(self, x, x_mark, task_id, enable_mask=False):
    def forward(self, x_enc, x_mark_enc, x_dec=None, x_mark_dec=None,
                mask=None, task_id=None, task_name=None, enable_mask=None):
```

---

# forword()
```python
 def forward(self, x_enc, x_mark_enc, x_dec=None, x_mark_dec=None,
                mask=None, task_id=None, task_name=None, enable_mask=None):
        if task_name == 'long_term_forecast' or task_name == 'short_term_forecast':
            dec_out = self.forecast(x_enc, x_mark_enc, task_id)
            return dec_out  # [B, L, D]
        if task_name == 'imputation':
            dec_out = self.imputation(
                x_enc, x_mark_enc, mask, task_id)
            return dec_out  # [B, L, D]
        if task_name == 'anomaly_detection':
            dec_out = self.anomaly_detection(x_enc, x_mark_enc, task_id)
            return dec_out  # [B, L, D]
        if task_name == 'classification':
            dec_out = self.classification(x_enc, x_mark_enc, task_id)
            return dec_out  # [B, N]
        if 'pretrain' in task_name:
            dec_out = self.pretraining(x_enc, x_mark_enc, task_id,
                                       enable_mask=enable_mask)
            return dec_out
        return None
```

---

# forecast()
```python
def forecast(self, x, x_mark, task_id):
        dataset_name = self.configs_list[task_id][1]['dataset']
        task_data_name = self.configs_list[task_id][0]
        prefix_prompt = self.prompt_tokens[dataset_name]
        task_prompt = self.mask_tokens[dataset_name]
        task_prompt_num = self.cls_nums[task_data_name][0]
        task_seq_num = self.cls_nums[task_data_name][1]
        real_seq_len = self.cls_nums[task_data_name][2]

        x, means, stdev, n_vars, _ = self.tokenize(x)
        x = self.prepare_prompt(
            x, n_vars, prefix_prompt, task_prompt, task_prompt_num, task_name='forecast')
        seq_token_len = x.shape[-2]-prefix_prompt.shape[2]
        x = self.backbone(x, prefix_prompt.shape[2], seq_token_len)
        x = self.forecast_head(
            x, real_seq_len, seq_token_len)
        x = x[:, -task_seq_num:]
        # De-Normalization from Non-stationary Transformer
        x = x * (stdev[:, 0, :].unsqueeze(1).repeat(1, x.shape[1], 1))
        x = x + (means[:, 0, :].unsqueeze(1).repeat(1, x.shape[1], 1))
        return x
```
---

# ForecastHead
```python
class ForecastHead(nn.Module):
    def __init__(self, d_model, patch_len, stride, pad, head_dropout=0, prefix_token_length=None):
        super().__init__()
        d_mid = d_model
        self.proj_in = nn.Linear(d_model, d_mid)
        self.mlp = Mlp(
            in_features=d_model,
            hidden_features=int(d_model * 4),
            act_layer=nn.GELU,
            drop=head_dropout,
        )
        self.proj_out = nn.Linear(d_model, patch_len)
        self.pad = pad
        self.patch_len = patch_len
        self.stride = stride
        self.pos_proj = DynamicLinear(
            in_features=128, out_features=128, fixed_in=prefix_token_length)

    def forward(self, x_full, pred_len, token_len):
        pass
        return x
```

---

# ForecastHead
```python
class ForecastHead(nn.Module):
    def __init__(self, d_model, patch_len, stride, pad, head_dropout=0, prefix_token_length=None):
        super().__init__()
        pass
    def forward(self, x_full, pred_len, token_len):
        x_full = self.proj_in(x_full)
        x_pred = x_full[:, :, -token_len:]
        x = x_full.transpose(-1, -2)
        x = self.pos_proj(x, token_len)
        x = x.transpose(-1, -2)
        x = x + x_pred
        x = self.mlp(x)
        x = self.proj_out(x)

        bs, n_vars = x.shape[0], x.shape[1]
        x = x.reshape(-1, x.shape[-2], x.shape[-1])
        x = x.permute(0, 2, 1)
        x = torch.nn.functional.fold(x, output_size=(
            pred_len, 1), kernel_size=(self.patch_len, 1), stride=(self.stride, 1))
        x = x.squeeze(dim=-1)
        x = x.reshape(bs, n_vars, -1)
        x = x.permute(0, 2, 1)
        return x
```
---

# backbone()
```python
def backbone(self, x, prefix_len, seq_len):
    attn_mask = None
    for block in self.blocks:
        x = block(x, prefix_seq_len=prefix_len +
                  seq_len, attn_mask=attn_mask)
    return x
```
```python
self.blocks = nn.ModuleList(
    [BasicBlock(dim=args.d_model, num_heads=args.n_heads, qkv_bias=False, qk_norm=False,
                mlp_ratio=8., proj_drop=args.dropout, attn_drop=0., drop_path=0.,
                init_values=None, prefix_token_length=args.prompt_num) for l in range(args.e_layers)]
)
```

---

# BasicBlock
```python
class BasicBlock(nn.Module):
    def __init__(
            self,
            dim,
            num_heads,
            mlp_ratio=8.,
            qkv_bias=False,
            qk_norm=False,
            proj_drop=0.,
            attn_drop=0.,
            init_values=None,
            drop_path=0.,
            act_layer=nn.GELU,
            norm_layer=nn.LayerNorm,
            prefix_token_length=0,
    ):
        super().__init__()
    def forward(self, x, prefix_seq_len, attn_mask):
        x = self.seq_att_block(x, attn_mask)
        x = self.var_att_block(x)
        x = self.dynamic_mlp(x, prefix_seq_len=prefix_seq_len)
        return x
```
